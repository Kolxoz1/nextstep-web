<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>NextStep</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
body{
  background:linear-gradient(180deg,#0b1220,#070b14);
  color:#fff;
  font-family:system-ui;
  padding:16px;
}
h2{margin:6px 0 10px}
input,button{
  width:100%;padding:12px;border-radius:14px;border:none;margin:6px 0;
}
button{background:#4f8cff;color:white;font-weight:600}
.tab{background:#1b2338}
.card{
  background:#151c2e;
  padding:10px;
  border-radius:12px;
  margin-bottom:6px;
}
.small{font-size:13px;opacity:.7}
</style>
</head>

<body>
<h2>NextStep</h2>

<input id="task" placeholder="ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: ĞºÑƒĞ¿Ğ¸Ñ‚ÑŒ Ğ¼Ğ¾Ğ»Ğ¾ĞºĞ¾">
<button onclick="addTask()">â• Add</button>

<button class="tab" onclick="load('inbox')">ğŸ“¥ Inbox</button>
<button class="tab" onclick="load('today')">ğŸ“… Today</button>
<button class="tab" onclick="load('focus')">ğŸ¯ Focus</button>
<button class="tab" onclick="openReview()">ğŸ“ Review</button>
<button class="tab" onclick="openHabits()">ğŸ” Habits</button>

<div id="list"></div>

<script>
const tg=Telegram.WebApp;tg.ready();
let current="inbox";

function send(d){tg.sendData(JSON.stringify(d))}

function addTask(){
 if(!task.value.trim())return;
 send({action:"add_task",title:task.value});
 task.value="";
}

function load(s){
 current=s;
 send({action:"get_tasks",status:s});
}

tg.onEvent("message",m=>{
 try{
  const d=JSON.parse(m.text);
  list.innerHTML="";
  if(d.tasks){
    d.tasks.forEach(t=>{
      const c=document.createElement("div");
      c.className="card";
      c.innerText=t;
      c.onclick=()=>move(t);
      list.appendChild(c);
    })
  }
  if(d.habits){
    d.habits.forEach(h=>{
      const c=document.createElement("div");
      c.className="card";
      c.innerText=(h[1]?"âœ… ":"â¬œ ")+h[0];
      c.onclick=()=>send({action:"toggle_habit",title:h[0]});
      list.appendChild(c);
    })
  }
 }catch{}
})

function move(title){
 const flow={inbox:"today",today:"focus",focus:"done"};
 if(flow[current])
   send({action:"move_task",title,to:flow[current]});
 load(current);
}

function openReview(){
 const t=prompt(
  "Review:\n1. Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ»?\n2. Ğ§Ñ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾?\n3. Ğ§Ñ‚Ğ¾ Ğ´Ğ°Ğ»ÑŒÑˆĞµ?"
 );
 if(t)send({action:"save_review",text:t});
}

function openHabits(){
 list.innerHTML="";
 const t=prompt("ĞĞ¾Ğ²Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ°:");
 if(t)send({action:"add_habit",title:t});
 send({action:"get_habits"});
}
</script>
</body>
</html>
