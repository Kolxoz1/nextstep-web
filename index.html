<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>NextStep</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root{
  --bg1:#0b1220;
  --bg2:#070b14;
  --card:#141b2f;
  --accent:#4f8cff;
  --text:#fff;
  --muted:#9aa4c1;
}
body{
  margin:0;
  background:linear-gradient(180deg,var(--bg1),var(--bg2));
  color:var(--text);
  font-family:system-ui,-apple-system;
  padding:16px;
}
h1{margin:6px 0 12px;font-size:26px}
input,button{
  width:100%;
  padding:14px;
  border-radius:16px;
  border:none;
  margin-bottom:10px;
  font-size:15px;
}
input{
  background:#fff;
  color:#000;
}
button{
  background:var(--accent);
  color:#fff;
  font-weight:600;
}
.menu button{
  background:var(--card);
}
.card{
  background:var(--card);
  padding:14px;
  border-radius:16px;
  margin-bottom:8px;
  cursor:pointer;
}
.footer{
  text-align:center;
  color:var(--muted);
  font-size:13px;
  margin-top:30px;
}
</style>
</head>

<body>
<h1>NextStep</h1>

<input id="task" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –∫—É–ø–∏—Ç—å –º–æ–ª–æ–∫–æ">
<button onclick="addTask()">‚ûï Add</button>

<div class="menu">
  <button onclick="load('inbox')">üì• Inbox</button>
  <button onclick="load('today')">üìÖ Today</button>
  <button onclick="load('focus')">üéØ Focus</button>
  <button onclick="openReview()">üìù Review</button>
  <button onclick="openHabits()">üîÅ Habits</button>
</div>

<div id="list"></div>

<div class="footer">@NextStepPlannerBot</div>

<script>
const tg = Telegram.WebApp;
tg.ready();

let current = "inbox";

function send(data){
  tg.sendData(JSON.stringify(data));
}

function addTask(){
  if(!task.value.trim())return;
  send({action:"add_task",title:task.value});
  task.value="";
}

function load(status){
  current=status;
  send({action:"get_tasks",status});
}

tg.onEvent("message",msg=>{
  try{
    const data=JSON.parse(msg.text);
    list.innerHTML="";
    if(data.tasks){
      data.tasks.forEach(t=>{
        const c=document.createElement("div");
        c.className="card";
        c.innerText=t;
        c.onclick=()=>move(t);
        list.appendChild(c);
      });
    }
    if(data.habits){
      data.habits.forEach(h=>{
        const c=document.createElement("div");
        c.className="card";
        c.innerText=(h[1]?"‚úÖ ":"‚¨ú ")+h[0];
        c.onclick=()=>send({action:"toggle_habit",title:h[0]});
        list.appendChild(c);
      });
    }
  }catch{}
});

function move(title){
  const flow={inbox:"today",today:"focus",focus:"done"};
  if(flow[current]){
    send({action:"move_task",title,to:flow[current]});
    load(current);
  }
}

function openReview(){
  const t=prompt(
    "Review –¥–Ω—è:\n\n1. –ß—Ç–æ —Å–¥–µ–ª–∞–ª?\n2. –ß—Ç–æ –±—ã–ª–æ –≤–∞–∂–Ω–æ?\n3. –ß—Ç–æ –¥–∞–ª—å—à–µ?"
  );
  if(t)send({action:"save_review",text:t});
}

function openHabits(){
  list.innerHTML="";
  const t=prompt("–ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞:");
  if(t)send({action:"add_habit",title:t});
  send({action:"get_habits"});
}
</script>
</body>
</html>
