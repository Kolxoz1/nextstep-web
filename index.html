<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NextStep</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        .dark-theme { 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        }
        .dark-theme .glass-card { 
            background: rgba(30, 30, 46, 0.95);
            border-color: rgba(255, 255, 255, 0.1);
        }
        .dark-theme .text-gray-900 { color: #fff !important; }
        .dark-theme .text-gray-700 { color: #e5e5e5 !important; }
        .dark-theme .text-gray-600 { color: #aaa !important; }
        .dark-theme .text-gray-500 { color: #888 !important; }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        
        .modal-backdrop { 
            position: fixed; inset: 0; 
            background: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            z-index: 999;
            animation: fadeIn 0.2s;
        }
        .modal-content { 
            position: fixed; bottom: 0; left: 0; right: 0; 
            background: white; 
            border-radius: 24px 24px 0 0; 
            z-index: 1000; 
            max-height: 85vh; 
            overflow-y: auto; 
            padding: 24px;
            animation: slideUp 0.3s;
            box-shadow: 0 -4px 24px rgba(0, 0, 0, 0.2);
        }
        .dark-theme .modal-content { background: #1e1e2e; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes float { 
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .task-card { 
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .task-card:active { transform: scale(0.97); }
        
        .floating-btn {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 64px;
            height: 64px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
            cursor: pointer;
            z-index: 100;
            transition: all 0.3s;
            animation: float 3s ease-in-out infinite;
        }
        .floating-btn:active { transform: scale(0.9); }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();

        const params = new URLSearchParams(window.location.search);
        const planFromUrl = params.get('plan') || 'free';
        const userIdFromUrl = params.get('user_id') || '';

        const t = {
            ru: {
                inbox: '–í—Ö–æ–¥—è—â–∏–µ', today: '–°–µ–≥–æ–¥–Ω—è', focus: '–§–æ–∫—É—Å', review: '–ì–æ—Ç–æ–≤–æ',
                habits: '–ü—Ä–∏–≤—ã—á–∫–∏', stats: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', subscription: '–ü–æ–¥–ø–∏—Å–∫–∞',
                support: '–ü–æ–º–æ—â—å', settings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏', shopping: '–ü–æ–∫—É–ø–∫–∏',
                tasks: '–∑–∞–¥–∞—á', noTasks: '–ù–µ—Ç –∑–∞–¥–∞—á', addTask: '–î–æ–±–∞–≤–∏—Ç—å',
                newTask: '–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞', priority: '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç',
                high: '–í—ã—Å–æ–∫–∏–π', medium: '–°—Ä–µ–¥–Ω–∏–π', low: '–ù–∏–∑–∫–∏–π', cancel: '–û—Ç–º–µ–Ω–∞',
                save: '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å', total: '–í—Å–µ–≥–æ', completed: '–ì–æ—Ç–æ–≤–æ', 
                language: '–Ø–∑—ã–∫', theme: '–¢–µ–º–∞', light: '–°–≤–µ—Ç–ª–∞—è', dark: '–¢–µ–º–Ω–∞—è',
                russian: '–†—É—Å—Å–∫–∏–π', english: 'English', helpTitle: '–ü–æ–º–æ—â—å',
                helpText: '–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏',
                writeSupport: '–ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É', free: 'FREE', premium: 'PREMIUM', pro: 'PRO',
                current: '–¢–µ–∫—É—â–∏–π', subscribe: '–û—Ñ–æ—Ä–º–∏—Ç—å',
                shoppingList: '–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫', addItem: '–î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä—ã',
                estimate: '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å', enterItems: '–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫',
                noHabits: '–ù–µ—Ç –ø—Ä–∏–≤—ã—á–µ–∫', addHabit: '–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É',
                streak: '–°–µ—Ä–∏—è', days: '–¥–Ω–µ–π', checkIn: '–û—Ç–º–µ—Ç–∏—Ç—å',
                newHabit: '–ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞', habitName: '–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏',
                chooseIcon: '–í—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É'
            }
        };

        class App {
            constructor() {
                this.view = 'today';
                this.plan = planFromUrl;
                this.userId = userIdFromUrl;
                this.tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
                this.habits = JSON.parse(localStorage.getItem('habits') || '[]');
                this.lang = localStorage.getItem('lang') || 'ru';
                this.theme = localStorage.getItem('theme') || 'light';
                this.init();
            }

            tr(key) { return t[this.lang]?.[key] || key; }

            init() {
                if (this.theme === 'dark') document.body.classList.add('dark-theme');
                this.render();
            }

            setView(v) {
                this.view = v;
                this.render();
            }

            addTask(text, priority = 'medium') {
                if (!text.trim()) return;
                this.tasks.unshift({
                    id: Date.now(), 
                    text: text.trim(), 
                    priority, 
                    status: 'today',
                    completed: false, 
                    date: new Date().toISOString().split('T')[0]
                });
                localStorage.setItem('tasks', JSON.stringify(this.tasks));
                this.render();
            }

            toggleTask(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    localStorage.setItem('tasks', JSON.stringify(this.tasks));
                    this.render();
                }
            }

            deleteTask(id) {
                this.tasks = this.tasks.filter(t => t.id !== id);
                localStorage.setItem('tasks', JSON.stringify(this.tasks));
                this.render();
            }

            moveTask(id, status) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.status = status;
                    localStorage.setItem('tasks', JSON.stringify(this.tasks));
                    this.render();
                }
            }

            addHabit(text, icon = '‚úÖ') {
                if (!text.trim()) return;
                this.habits.push({
                    id: Date.now(),
                    text: text.trim(),
                    icon,
                    streak: 0,
                    lastDone: null
                });
                localStorage.setItem('habits', JSON.stringify(this.habits));
                this.render();
            }

            checkHabit(id) {
                const habit = this.habits.find(h => h.id === id);
                if (habit) {
                    const today = new Date().toISOString().split('T')[0];
                    if (habit.lastDone === today) return;
                    
                    const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
                    if (habit.lastDone === yesterday) {
                        habit.streak++;
                    } else {
                        habit.streak = 1;
                    }
                    habit.lastDone = today;
                    localStorage.setItem('habits', JSON.stringify(this.habits));
                    this.render();
                }
            }

            deleteHabit(id) {
                this.habits = this.habits.filter(h => h.id !== id);
                localStorage.setItem('habits', JSON.stringify(this.habits));
                this.render();
            }

            changeLang(lang) {
                this.lang = lang;
                localStorage.setItem('lang', lang);
                this.render();
            }

            toggleTheme() {
                this.theme = this.theme === 'light' ? 'dark' : 'light';
                localStorage.setItem('theme', this.theme);
                document.body.classList.toggle('dark-theme');
                this.render();
            }

            showAddTaskModal() {
                const modal = document.createElement('div');
                modal.innerHTML = `
                    <div class="modal-backdrop" onclick="app.closeModal()"></div>
                    <div class="modal-content">
                        <h3 class="text-2xl font-bold mb-6 gradient-text">‚ú® ${this.tr('newTask')}</h3>
                        <input type="text" id="taskInput" placeholder="${this.tr('enterItems')}..." 
                            class="w-full p-4 border-2 border-purple-200 rounded-2xl mb-4 text-base focus:outline-none focus:border-purple-500 transition-all">
                        <p class="text-sm font-semibold mb-3 text-gray-700">${this.tr('priority')}:</p>
                        <div class="grid grid-cols-3 gap-3 mb-6">
                            <button onclick="app.addFromModal('high')" 
                                class="py-4 bg-gradient-to-br from-red-400 to-red-600 text-white rounded-2xl font-bold shadow-lg active:shadow-md transform active:scale-95 transition-all">
                                üî¥ ${this.tr('high')}
                            </button>
                            <button onclick="app.addFromModal('medium')" 
                                class="py-4 bg-gradient-to-br from-yellow-400 to-orange-500 text-white rounded-2xl font-bold shadow-lg active:shadow-md transform active:scale-95 transition-all">
                                üü° ${this.tr('medium')}
                            </button>
                            <button onclick="app.addFromModal('low')" 
                                class="py-4 bg-gradient-to-br from-green-400 to-green-600 text-white rounded-2xl font-bold shadow-lg active:shadow-md transform active:scale-95 transition-all">
                                üü¢ ${this.tr('low')}
                            </button>
                        </div>
                        <button onclick="app.closeModal()" 
                            class="w-full py-4 bg-gray-100 text-gray-700 rounded-2xl font-bold active:bg-gray-200 transition-all">
                            ${this.tr('cancel')}
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
                setTimeout(() => document.getElementById('taskInput')?.focus(), 100);
            }

            showAddHabitModal() {
                const modal = document.createElement('div');
                modal.innerHTML = `
                    <div class="modal-backdrop" onclick="app.closeModal()"></div>
                    <div class="modal-content">
                        <h3 class="text-2xl font-bold mb-6 gradient-text">‚ú® ${this.tr('newHabit')}</h3>
                        <input type="text" id="habitInput" placeholder="${this.tr('habitName')}..." 
                            class="w-full p-4 border-2 border-purple-200 rounded-2xl mb-4 text-base focus:outline-none focus:border-purple-500 transition-all">
                        <p class="text-sm font-semibold mb-3 text-gray-700">${this.tr('chooseIcon')}:</p>
                        <div class="grid grid-cols-4 gap-3 mb-6">
                            ${['üí™', 'üìö', 'üèÉ', 'üßò', 'üíß', 'ü•ó', 'üò¥', 'üéØ', 'üö¥', 'üé®', '‚úçÔ∏è', 'üéµ'].map(icon => `
                                <button onclick="app.addHabitFromModal('${icon}')" 
                                    class="py-4 text-3xl bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl active:scale-95 transition-all border-2 border-purple-100">
                                    ${icon}
                                </button>
                            `).join('')}
                        </div>
                        <button onclick="app.closeModal()" 
                            class="w-full py-4 bg-gray-100 text-gray-700 rounded-2xl font-bold active:bg-gray-200 transition-all">
                            ${this.tr('cancel')}
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
                setTimeout(() => document.getElementById('habitInput')?.focus(), 100);
            }

            showShoppingModal() {
                const modal = document.createElement('div');
                modal.innerHTML = `
                    <div class="modal-backdrop" onclick="app.closeModal()"></div>
                    <div class="modal-content">
                        <h3 class="text-2xl font-bold mb-6 gradient-text">üõí ${this.tr('shoppingList')}</h3>
                        <p class="text-sm text-gray-600 mb-3">–í–≤–µ–¥–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã (–∫–∞–∂–¥—ã–π —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏):</p>
                        <textarea id="shoppingInput" placeholder="–•–ª–µ–±\n–ú–æ–ª–æ–∫–æ\n–Ø–π—Ü–∞\n–ú–∞—Å–ª–æ\n..." 
                            class="w-full p-4 border-2 border-purple-200 rounded-2xl mb-4 text-base h-48 focus:outline-none focus:border-purple-500 resize-none transition-all"></textarea>
                        <button onclick="app.estimateShopping()" 
                            class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl font-bold mb-3 shadow-lg active:shadow-md transform active:scale-95 transition-all">
                            üí∞ ${this.tr('estimate')}
                        </button>
                        <button onclick="app.closeModal()" 
                            class="w-full py-4 bg-gray-100 text-gray-700 rounded-2xl font-bold active:bg-gray-200 transition-all">
                            ${this.tr('cancel')}
                        </button>
                    </div>
                `;
                document.body.appendChild(modal);
                setTimeout(() => document.getElementById('shoppingInput')?.focus(), 100);
            }

            estimateShopping() {
                const input = document.getElementById('shoppingInput');
                if (input?.value.trim()) {
                    try {
                        tg.sendData(JSON.stringify({
                            action: 'estimate_shopping',
                            items: input.value.trim()
                        }));
                        this.closeModal();
                    } catch (e) {
                        alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.');
                    }
                } else {
                    alert('–í–≤–µ–¥–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω —Ç–æ–≤–∞—Ä');
                }
            }

            addFromModal(priority) {
                const input = document.getElementById('taskInput');
                if (input?.value.trim()) {
                    this.addTask(input.value, priority);
                    this.closeModal();
                }
            }

            addHabitFromModal(icon) {
                const input = document.getElementById('habitInput');
                if (input?.value.trim()) {
                    this.addHabit(input.value, icon);
                    this.closeModal();
                }
            }

            closeModal() {
                document.querySelectorAll('.modal-backdrop').forEach(m => m.parentElement?.remove());
            }

            getFiltered() {
                return this.tasks.filter(t => {
                    if (this.view === 'inbox') return t.status === 'inbox' && !t.completed;
                    if (this.view === 'today') return t.status === 'today' && !t.completed;
                    if (this.view === 'focus') return t.status === 'focus' && !t.completed;
                    if (this.view === 'review') return t.completed;
                    return true;
                });
            }

            render() {
                const tasks = this.getFiltered();
                const completed = this.tasks.filter(t => t.completed).length;
                
                document.getElementById('root').innerHTML = `
                    <div class="min-h-screen pb-24">
                        <!-- –®–∞–ø–∫–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–º -->
                        <div class="px-6 pt-8 pb-6">
                            <div class="flex justify-between items-start mb-6">
                                <div>
                                    <h1 class="text-3xl font-bold text-white mb-1">NextStep</h1>
                                    <p class="text-white text-opacity-80 text-sm">${new Date().toLocaleDateString('ru-RU', {weekday: 'long', day: 'numeric', month: 'long'})}</p>
                                </div>
                                <div class="px-4 py-2 bg-white bg-opacity-20 backdrop-blur-sm rounded-full text-white text-xs font-bold">
                                    ${this.plan.toUpperCase()}
                                </div>
                            </div>

                            <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è Pills -->
                            <div class="flex gap-2 overflow-x-auto scrollbar-hide pb-2">
                                ${['today', 'inbox', 'focus', 'review', 'habits', 'shopping', 'stats', 'subscription', 'support', 'settings'].map(v => `
                                    <button onclick="app.setView('${v}')" 
                                        class="px-5 py-2.5 rounded-full whitespace-nowrap text-sm font-bold transition-all ${
                                            this.view === v 
                                                ? 'bg-white text-purple-600 shadow-lg' 
                                                : 'bg-white bg-opacity-20 text-white hover:bg-opacity-30'
                                        }">
                                        ${this.tr(v)}
                                    </button>
                                `).join('')}
                            </div>
                        </div>

                        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç -->
                        <div class="px-4">
                            ${this.view === 'stats' ? this.renderStats(completed) : 
                              this.view === 'settings' ? this.renderSettings() :
                              this.view === 'subscription' ? this.renderSubscription() :
                              this.view === 'habits' ? this.renderHabits() :
                              this.view === 'shopping' ? this.renderShopping() :
                              this.view === 'support' ? this.renderSupport() :
                              this.renderTasks(tasks)}
                        </div>
                    </div>

                    ${['today', 'inbox', 'focus'].includes(this.view) ? `
                        <div class="floating-btn" onclick="app.showAddTaskModal()">+</div>
                    ` : ''}
                    ${this.view === 'habits' ? `
                        <div class="floating-btn" onclick="app.showAddHabitModal()">+</div>
                    ` : ''}
                    ${this.view === 'shopping' ? `
                        <div class="floating-btn" onclick="app.showShoppingModal()">üõí</div>
                    ` : ''}
                `;
            }

            renderTasks(tasks) {
                if (!tasks.length) {
                    const emojis = { today: 'üìÖ', inbox: 'üì•', focus: 'üéØ', review: '‚úÖ' };
                    return `
                        <div class="text-center py-20">
                            <div class="w-32 h-32 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-6 backdrop-blur-sm">
                                <span class="text-6xl">${emojis[this.view] || '‚ú®'}</span>
                            </div>
                            <p class="text-xl font-bold text-white mb-2">${this.tr('noTasks')}</p>
                            <p class="text-white text-opacity-70 text-sm">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</p>
                        </div>
                    `;
                }

                return tasks.map(t => `
                    <div class="task-card glass-card rounded-3xl p-5 mb-4">
                        <div class="flex gap-4">
                            <button onclick="app.toggleTask(${t.id})" 
                                class="w-7 h-7 rounded-full border-2 flex items-center justify-center flex-shrink-0 transition-all ${
                                    t.completed ? 'bg-gradient-to-br from-green-400 to-green-600 border-green-600' : 'border-purple-300 hover:border-purple-500'
                                }">
                                ${t.completed ? '<span class="text-white text-sm font-bold">‚úì</span>' : ''}
                            </button>
                            <div class="flex-1 min-w-0">
                                <p class="font-semibold text-base ${t.completed ? 'line-through text-gray-400' : 'text-gray-900'} mb-2">${t.text}</p>
                                <div class="flex gap-2 items-center flex-wrap">
                                    <span class="text-xs px-3 py-1.5 rounded-full font-bold ${
                                        t.priority === 'high' ? 'bg-gradient-to-r from-red-400 to-red-500 text-white' : 
                                        t.priority === 'medium' ? 'bg-gradient-to-r from-yellow-400 to-orange-400 text-white' : 
                                        'bg-gradient-to-r from-green-400 to-green-500 text-white'
                                    } shadow-md">
                                        ${t.priority === 'high' ? 'üî¥' : t.priority === 'medium' ? 'üü°' : 'üü¢'}
                                    </span>
                                    ${!t.completed ? `
                                        <select onchange="app.moveTask(${t.id}, this.value)" 
                                            class="text-xs px-3 py-1.5 rounded-full bg-purple-50 text-purple-700 border-none font-semibold">
                                            <option value="inbox" ${t.status === 'inbox' ? 'selected' : ''}>üì• Inbox</option>
                                            <option value="today" ${t.status === 'today' ? 'selected' : ''}>üìÖ Today</option>
                                            <option value="focus" ${t.status === 'focus' ? 'selected' : ''}>üéØ Focus</option>
                                        </select>
                                    ` : ''}
                                </div>
                            </div>
                            <button onclick="app.deleteTask(${t.id})" class="text-red-400 hover:text-red-600 text-2xl font-bold">√ó</button>
                        </div>
                    </div>
                `).join('');
            }

            renderHabits() {
                if (!this.habits.length) {
                    return `
                        <div class="text-center py-20">
                            <div class="w-32 h-32 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-6 backdrop-blur-sm">
                                <span class="text-6xl">üéØ</span>
                            </div>
                            <p class="text-xl font-bold text-white mb-2">${this.tr('noHabits')}</p>
                            <p class="text-white text-opacity-70 text-sm">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</p>
                        </div>
                    `;
                }

                const today = new Date().toISOString().split('T')[0];
                
                return this.habits.map(h => {
                    const isDone = h.lastDone === today;
                    return `
                        <div class="glass-card rounded-3xl p-5 mb-4">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 rounded-2xl bg-gradient-to-br from-purple-100 to-pink-100 flex items-center justify-center text-4xl">
                                    ${h.icon}
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-lg text-gray-900">${h.text}</p>
                                    <p class="text-sm text-gray-500 mt-1">üî• ${this.tr('streak')}: ${h.streak} ${this.tr('days')}</p>
                                </div>
                                <div class="flex gap-2">
                                    <button onclick="app.checkHabit(${h.id})" 
                                        class="px-5 py-3 rounded-2xl font-bold text-sm transition-all shadow-md ${
                                            isDone ? 'bg-gradient-to-br from-green-100 to-green-200 text-green-700' : 'bg-gradient-to-br from-purple-500 to-pink-500 text-white active:shadow-sm'
                                        }" ${isDone ? 'disabled' : ''}>
                                        ‚úì
                                    </button>
                                    <button onclick="app.deleteHabit(${h.id})" class="text-red-400 hover:text-red-600 text-2xl font-bold px-2">√ó</button>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderShopping() {
                return `
                    <div class="text-center py-20">
                        <div class="w-32 h-32 bg-white bg-opacity-20 rounded-full flex items-center justify-center mx-auto mb-6 backdrop-blur-sm">
                            <span class="text-6xl">üõí</span>
                        </div>
                        <p class="text-xl font-bold text-white mb-2">${this.tr('shoppingList')}</p>
                        <p class="text-white text-opacity-70 text-sm mb-8">–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏ –ø–æ–ª—É—á–∏—Ç–µ –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å</p>
                        <button onclick="app.showShoppingModal()" 
                            class="px-8 py-4 bg-white text-purple-600 rounded-2xl font-bold shadow-lg active:shadow-md transform active:scale-95 transition-all">
                            ${this.tr('addItem')}
                        </button>
                    </div>
                `;
            }

            renderStats(completed) {
                return `
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        ${[
                            { icon: 'üìã', label: this.tr('total'), value: this.tasks.length },
                            { icon: '‚úÖ', label: this.tr('completed'), value: completed },
                            { icon: 'üéØ', label: this.tr('habits'), value: this.habits.length },
                            { icon: 'üî•', label: 'Streak', value: Math.max(...this.habits.map(h => h.streak), 0) }
                        ].map(s => `
                            <div class="glass-card rounded-3xl p-5">
                                <div class="text-4xl mb-3">${s.icon}</div>
                                <p class="text-xs text-gray-600 mb-1 font-semibold">${s.label}</p>
                                <p class="text-3xl font-bold gradient-text">${s.value}</p>
                            </div>
                        `).join('')}
                    </div>
                    <div class="glass-card rounded-3xl p-5">
                        <h3 class="font-bold text-xl text-gray-900 mb-3">üìà –ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
                        <p class="text-sm text-gray-500 text-center py-8">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</p>
                    </div>
                `;
            }

            renderSupport() {
                return `
                    <div class="glass-card rounded-3xl p-6">
                        <div class="text-center mb-6">
                            <div class="w-24 h-24 bg-gradient-to-br from-purple-400 to-purple-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg">
<span class="text-5xl">üí¨</span>
</div>
<h2 class="text-2xl font-bold mb-2 gradient-text">${this.tr('helpTitle')}</h2>
<p class="text-gray-600 text-sm">${this.tr('helpText')}</p>
</div>
<div class="space-y-3 mb-6">
${[
{ icon: 'üìã', title: '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–¥–∞—á–∞–º–∏', text: '–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ –∏ –ø–µ—Ä–µ–º–µ—â–∞–π—Ç–µ –∏—Ö –º–µ–∂–¥—É —Å—Ç–∞—Ç—É—Å–∞–º–∏' },
{ icon: 'üéØ', title: '–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫', text: '–û—Ç–º–µ—á–∞–π—Ç–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –∏ —Å–ª–µ–¥–∏—Ç–µ –∑–∞ —Å–µ—Ä–∏–µ–π' },
{ icon: 'üõí', title: '–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫', text: 'AI —Ä–∞—Å—Å—á–∏—Ç–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å –≤–∞—à–∏—Ö –ø–æ–∫—É–ø–æ–∫' }
].map(item => `
    <div class="flex items-start gap-3 p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl">
        <span class="text-3xl">${item.icon}</span>
        <div>
            <h4 class="font-bold text-sm text-gray-900">${item.title}</h4>
            <p class="text-xs text-gray-600 mt-1">${item.text}</p>
        </div>
    </div>
`).join('')
</div>
<a href="https://t.me/NextStepSupport" target="_blank">
<button class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl font-bold shadow-lg active:shadow-md mb-2">
üí¨ ${this.tr('writeSupport')}
</button>
</a>
<p class="text-xs text-gray-500 text-center">@NextStepSupport</p>
</div>
`;
}

renderSettings() {
            return `
                <div class="space-y-4">
                    <div class="glass-card rounded-3xl p-5">
                        <p class="font-bold mb-4 text-gray-900">${this.tr('language')}</p>
                        <div class="grid grid-cols-2 gap-3">
                            <button onclick="app.changeLang('ru')" 
                                class="py-3 rounded-2xl font-bold transition-all ${this.lang === 'ru' ? 'bg-gradient-to-r from-purple-600 to-purple-700 text-white shadow-lg' : 'bg-gray-100 text-gray-700 active:bg-gray-200'}">
                                üá∑üá∫ –†—É—Å—Å–∫–∏–π
                            </button>
                            <button onclick="app.changeLang('en')" 
                                class="py-3 rounded-2xl font-bold transition-all ${this.lang === 'en' ? 'bg-gradient-to-r from-purple-600 to-purple-700 text-white shadow-lg' : 'bg-gray-100 text-gray-700 active:bg-gray-200'}">
                                üá¨üáß English
                            </button>
                        </div>
                    </div>
                    <div class="glass-card rounded-3xl p-5">
                        <p class="font-bold mb-4 text-gray-900">${this.tr('theme')}</p>
                        <button onclick="app.toggleTheme()" 
                            class="w-full py-3 rounded-2xl font-bold bg-gradient-to-r from-purple-600 to-purple-700 text-white shadow-lg active:shadow-md">
                            ${this.theme === 'light' ? 'üåô ' + this.tr('dark') : '‚òÄÔ∏è ' + this.tr('light')}
                        </button>
                    </div>
                </div>
            `;
        }

        renderSubscription() {
            const plans = [
                {
                    key: 'free',
                    name: 'FREE',
                    icon: 'üÜì',
                    price: '–ë–µ—Å–ø–ª–∞—Ç–Ω–æ',
                    features: ['–î–æ 50 –∑–∞–¥–∞—á', '–ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏', '–°–ø–∏—Å–æ–∫ –ø–æ–∫—É–ø–æ–∫'],
                    current: this.plan === 'free'
                },
                {
                    key: 'premium',
                    name: 'PREMIUM',
                    icon: '‚≠ê',
                    price: '149‚ÇΩ/–º–µ—Å',
                    features: ['–ë–µ–∑ –ª–∏–º–∏—Ç–æ–≤', '–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', 'AI —Ä–∞—Å—á–µ—Ç –ø–æ–∫—É–ø–æ–∫', '–¢–µ–º–Ω–∞—è —Ç–µ–º–∞'],
                    current: this.plan === 'premium'
                },
                {
                    key: 'pro',
                    name: 'PRO',
                    icon: 'üèÜ',
                    price: '219‚ÇΩ/–º–µ—Å',
                    features: ['–í—Å—ë –∏–∑ Premium', 'AI –ø–æ–º–æ—â–Ω–∏–∫', '–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏', '–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞'],
                    current: this.plan === 'pro'
                }
            ];
            
            return plans.map(p => `
                <div class="glass-card rounded-3xl p-5 ${p.current ? 'ring-2 ring-white ring-opacity-50 shadow-2xl' : ''} mb-4">
                    ${p.current ? '<div class="inline-block bg-gradient-to-r from-green-500 to-green-600 text-white text-xs font-bold px-4 py-2 rounded-full mb-3 shadow-lg">‚úì –¢–µ–∫—É—â–∏–π —Ç–∞—Ä–∏—Ñ</div>' : ''}
                    <div class="flex items-center gap-4 mb-4">
                        <span class="text-5xl">${p.icon}</span>
                        <div>
                            <h3 class="text-2xl font-bold gradient-text">${p.name}</h3>
                            <p class="text-sm text-gray-600 font-bold">${p.price}</p>
                        </div>
                    </div>
                    <div class="space-y-2 mb-4">
                        ${p.features.map(f => `
                            <div class="flex items-center gap-3 text-sm text-gray-700">
                                <span class="text-green-500 font-bold text-lg">‚úì</span>
                                <span class="font-medium">${f}</span>
                            </div>
                        `).join('')}
                    </div>
                    ${!p.current && p.key !== 'free' ? `
                        <button class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl font-bold shadow-lg active:shadow-md transform active:scale-95 transition-all">
                            ${this.tr('subscribe')}
                        </button>
                    ` : ''}
                </div>
            `).join('') + `<p class="text-xs text-white text-opacity-70 text-center mt-4">üí≥ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram</p>`;
        }
    }

    const app = new App();
    window.app = app;
</script>
</body>
</html>