<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<title>NextStep</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root{
  --bg:#0b1220;
  --card:#141b2f;
  --accent:#4f8cff;
  --muted:#9aa4c1;
}
body{
  margin:0;
  background:linear-gradient(180deg,#0b1220,#070b14);
  color:#fff;
  font-family:system-ui;
  padding:16px;
}
h1{margin:4px 0 12px}
input,button{
  width:100%;padding:14px;border-radius:16px;border:none;margin-bottom:10px;
}
button{background:var(--accent);color:white;font-weight:600}
.menu button{background:var(--card)}
.card{
  background:var(--card);
  padding:14px;
  border-radius:16px;
  margin-bottom:8px;
}
.stat{color:var(--muted);font-size:14px}
</style>
</head>

<body>
<h1>NextStep</h1>

<input id="task" placeholder="ĞĞ¾Ğ²Ğ°Ñ Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ°">
<button onclick="addTask()">â• Add</button>

<div class="menu">
  <button onclick="load('inbox')">ğŸ“¥ Inbox</button>
  <button onclick="load('today')">ğŸ“… Today</button>
  <button onclick="load('focus')">ğŸ¯ Focus</button>
  <button onclick="ai()">ğŸ¤– AI Plan</button>
  <button onclick="stats()">ğŸ“Š Stats</button>
  <button onclick="review()">ğŸ“ Review</button>
  <button onclick="habits()">ğŸ” Habits</button>
</div>

<div id="list"></div>

<script>
const tg = Telegram.WebApp; tg.ready();
let current="inbox";

function send(d){tg.sendData(JSON.stringify(d))}

function addTask(){
 if(!task.value.trim())return;
 send({action:"add_task",title:task.value});
 task.value="";
}

function load(s){
 current=s;
 send({action:"get_tasks",status:s});
}

tg.onEvent("message",m=>{
 try{
  const d=JSON.parse(m.text);
  list.innerHTML="";
  if(d.tasks){
    d.tasks.forEach(t=>{
      const c=document.createElement("div");
      c.className="card";
      c.innerText=t;
      c.onclick=()=>move(t);
      list.appendChild(c);
    })
  }
  if(d.habits){
    d.habits.forEach(h=>{
      const c=document.createElement("div");
      c.className="card";
      c.innerText=(h[1]?"âœ… ":"â¬œ ")+h[0];
      c.onclick=()=>send({action:"toggle_habit",title:h[0]});
      list.appendChild(c);
    })
  }
  if(d.stats){
    for(const k in d.stats){
      const s=document.createElement("div");
      s.className="stat";
      s.innerText=`${k}: ${d.stats[k]}`;
      list.appendChild(s);
    }
  }
  if(d.ai){
    d.ai.forEach(t=>{
      const c=document.createElement("div");
      c.className="card";
      c.innerText="â­ "+t;
      list.appendChild(c);
    })
  }
 }catch{}
});

function move(title){
 const flow={inbox:"today",today:"focus",focus:"done"};
 if(flow[current]){
  send({action:"move_task",title,to:flow[current]});
  load(current);
 }
}

function review(){
 const t=prompt("Review:\n1. Ğ§Ñ‚Ğ¾ ÑĞ´ĞµĞ»Ğ°Ğ»?\n2. Ğ§Ñ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾?\n3. Ğ§Ñ‚Ğ¾ Ğ´Ğ°Ğ»ÑŒÑˆĞµ?");
 if(t)send({action:"save_review",text:t});
}

function habits(){
 const t=prompt("ĞĞ¾Ğ²Ğ°Ñ Ğ¿Ñ€Ğ¸Ğ²Ñ‹Ñ‡ĞºĞ°:");
 if(t)send({action:"add_habit",title:t});
 send({action:"get_habits"});
}

function stats(){ send({action:"stats"}) }
function ai(){ send({action:"ai_plan"}) }
</script>
</body>
</html>
