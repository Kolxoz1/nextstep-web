<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#7C3AED">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>NextStep</title>
    
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            -webkit-font-smoothing: antialiased;
            background: #F8FAFC;
        }
        
        #root {
            min-height: 100vh;
        }
        
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 999;
            animation: fadeIn 0.2s;
        }
        
        .modal-content {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 24px 24px 0 0;
            z-index: 1000;
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.1);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .task-card {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: manipulation;
        }
        
        .task-card:active {
            transform: scale(0.98);
        }
        
        .glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .floating {
            animation: floating 3s ease-in-out infinite;
        }
        
        @keyframes floating {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .shine {
            position: relative;
            overflow: hidden;
        }
        
        .shine::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            transition: left 0.5s;
        }
        
        .shine:hover::before {
            left: 100%;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();
        tg.expand();
        tg.enableClosingConfirmation();
        tg.setHeaderColor('#7C3AED');
        tg.setBackgroundColor('#F8FAFC');

        const storage = {
            get: (key) => {
                try {
                    return JSON.parse(localStorage.getItem(key));
                } catch {
                    return null;
                }
            },
            set: (key, value) => {
                localStorage.setItem(key, JSON.stringify(value));
            }
        };

        class NextStepApp {
            constructor() {
                this.view = 'inbox';
                this.tasks = storage.get('tasks') || [];
                this.habits = storage.get('habits') || this.getDefaultHabits();
                this.userPlan = 'free'; // free, premium, pro
                
                this.init();
            }

            getDefaultHabits() {
                return [
                    { id: 1, title: '–£—Ç—Ä–µ–Ω–Ω—è—è –∑–∞—Ä—è–¥–∫–∞', icon: 'üí™', streak: 0, lastDone: null },
                    { id: 2, title: '–ß–∏—Ç–∞—Ç—å 30 –º–∏–Ω—É—Ç', icon: 'üìö', streak: 0, lastDone: null },
                    { id: 3, title: '–ú–µ–¥–∏—Ç–∞—Ü–∏—è 10 –º–∏–Ω', icon: 'üßò', streak: 0, lastDone: null },
                    { id: 4, title: '–í—ã–ø–∏—Ç—å 2–ª –≤–æ–¥—ã', icon: 'üíß', streak: 0, lastDone: null }
                ];
            }

            init() {
                this.render();
                this.setupTelegramHandlers();
                tg.HapticFeedback.impactOccurred('light');
            }

            setupTelegramHandlers() {
                tg.MainButton.setText('‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É');
                tg.MainButton.onClick(() => this.showAddTaskModal());
                tg.MainButton.show();
                tg.MainButton.color = '#7C3AED';
                
                tg.BackButton.onClick(() => {
                    if (this.view !== 'inbox') {
                        this.setView('inbox');
                    }
                });
            }

            sendData(data) {
                tg.sendData(JSON.stringify(data));
            }

            setView(view) {
                this.view = view;
                
                if (view === 'inbox') {
                    tg.BackButton.hide();
                    tg.MainButton.show();
                    tg.MainButton.setText('‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É');
                } else {
                    tg.BackButton.show();
                    if (view === 'subscription' || view === 'support') {
                        tg.MainButton.hide();
                    } else {
                        tg.MainButton.show();
                        if (view === 'habits') {
                            tg.MainButton.setText('‚ûï –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É');
                            tg.MainButton.onClick(() => this.showAddHabitModal());
                        } else {
                            tg.MainButton.setText('‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É');
                            tg.MainButton.onClick(() => this.showAddTaskModal());
                        }
                    }
                }
                
                this.render();
                tg.HapticFeedback.impactOccurred('light');
            }

            addTask(text, priority = 'medium') {
                if (!text.trim()) return;
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–∞ –¥–ª—è Free –ø–ª–∞–Ω–∞
                if (this.userPlan === 'free' && this.tasks.length >= 50) {
                    this.showUpgradeModal('–î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç –≤ 50 –∑–∞–¥–∞—á.\n–û–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ Premium –¥–ª—è –Ω–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á!');
                    return;
                }
                
                const task = {
                    id: Date.now(),
                    text: text.trim(),
                    completed: false,
                    status: this.view === 'inbox' || this.view === 'today' || this.view === 'focus' ? this.view : 'inbox',
                    date: new Date().toISOString().split('T')[0],
                    priority,
                    createdAt: new Date().toISOString()
                };
                
                this.tasks.unshift(task);
                storage.set('tasks', this.tasks);
                this.sendData({ action: 'add_task', ...task });
                this.render();
                
                tg.HapticFeedback.notificationOccurred('success');
                tg.showPopup({
                    title: '‚úÖ –ì–æ—Ç–æ–≤–æ',
                    message: '–ó–∞–¥–∞—á–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞',
                    buttons: [{ type: 'ok' }]
                });
            }

            toggleTask(id) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.completed = !task.completed;
                    storage.set('tasks', this.tasks);
                    this.sendData({ action: 'complete_task', task_id: id });
                    this.render();
                    tg.HapticFeedback.notificationOccurred('success');
                }
            }

            deleteTask(id) {
                tg.showConfirm('–£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É?', (confirmed) => {
                    if (confirmed) {
                        this.tasks = this.tasks.filter(t => t.id !== id);
                        storage.set('tasks', this.tasks);
                        this.sendData({ action: 'delete_task', task_id: id });
                        this.render();
                        tg.HapticFeedback.notificationOccurred('warning');
                    }
                });
            }

            moveTask(id, newStatus) {
                const task = this.tasks.find(t => t.id === id);
                if (task) {
                    task.status = newStatus;
                    storage.set('tasks', this.tasks);
                    this.sendData({ action: 'move_task', task_id: id, to: newStatus });
                    this.render();
                    tg.HapticFeedback.impactOccurred('light');
                }
            }

            addHabit(title, icon = '‚úÖ') {
                if (!title.trim()) return;
                
                const habit = {
                    id: Date.now(),
                    title: title.trim(),
                    icon,
                    streak: 0,
                    lastDone: null
                };
                
                this.habits.push(habit);
                storage.set('habits', this.habits);
                this.sendData({ action: 'add_habit', ...habit });
                this.render();
                tg.HapticFeedback.notificationOccurred('success');
            }

            checkHabit(id) {
                const habit = this.habits.find(h => h.id === id);
                if (!habit) return;
                
                const today = new Date().toISOString().split('T')[0];
                
                if (habit.lastDone === today) {
                    tg.showAlert('–í—ã —É–∂–µ –æ—Ç–º–µ—Ç–∏–ª–∏ —ç—Ç—É –ø—Ä–∏–≤—ã—á–∫—É —Å–µ–≥–æ–¥–Ω—è! üéØ');
                    return;
                }
                
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                const yesterdayStr = yesterday.toISOString().split('T')[0];
                
                if (habit.lastDone === yesterdayStr) {
                    habit.streak += 1;
                } else {
                    habit.streak = 1;
                }
                
                habit.lastDone = today;
                storage.set('habits', this.habits);
                this.sendData({ action: 'check_habit', habit_id: id });
                this.render();
                
                tg.HapticFeedback.notificationOccurred('success');
                
                if (habit.streak === 7) {
                    tg.showAlert('üéâ –ù–µ–¥–µ–ª—è –ø–æ–¥—Ä—è–¥! –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ!');
                } else if (habit.streak === 30) {
                    tg.showAlert('üèÜ –ú–µ—Å—è—Ü –ø–æ–¥—Ä—è–¥! –í—ã –ª–µ–≥–µ–Ω–¥–∞!');
                }
            }

            getFilteredTasks() {
                return this.tasks.filter(task => {
                    if (this.view === 'inbox') return task.status === 'inbox' && !task.completed;
                    if (this.view === 'today') return task.status === 'today' && !task.completed;
                    if (this.view === 'focus') return task.status === 'focus' && !task.completed;
                    if (this.view === 'review') return task.completed;
                    return true;
                });
            }

            showAddTaskModal() {
                const modal = document.createElement('div');
                modal.innerHTML = `
                    <div class="modal-backdrop" onclick="app.closeModal()"></div>
                    <div class="modal-content p-6">
                        <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
                        <h3 class="text-2xl font-bold text-gray-800 mb-4 gradient-text">‚ú® –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</h3>
                        <input 
                            type="text" 
                            id="taskInput"
                            placeholder="–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å?"
                            class="w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:outline-none focus:border-purple-500 mb-4 text-base transition-all"
                            autofocus
                        />
                        <div class="mb-4">
                            <p class="text-sm text-gray-600 mb-3 font-semibold">–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:</p>
                            <div class="grid grid-cols-3 gap-3">
                                <button onclick="app.addTaskWithPriority('high')" class="shine py-4 bg-gradient-to-br from-red-400 to-red-600 text-white rounded-2xl font-semibold shadow-lg active:shadow-md">
                                    üî¥ –í—ã—Å–æ–∫–∏–π
                                </button>
                                <button onclick="app.addTaskWithPriority('medium')" class="shine py-4 bg-gradient-to-br from-yellow-400 to-orange-500 text-white rounded-2xl font-semibold shadow-lg active:shadow-md">
                                    üü° –°—Ä–µ–¥–Ω–∏–π
                                </button>
                                <button onclick="app.addTaskWithPriority('low')" class="shine py-4 bg-gradient-to-br from-green-400 to-green-600 text-white rounded-2xl font-semibold shadow-lg active:shadow-md">
                                    üü¢ –ù–∏–∑–∫–∏–π
                                </button>
                            </div>
                        </div>
                        <button onclick="app.closeModal()" class="w-full py-4 bg-gray-100 text-gray-700 rounded-2xl font-semibold active:bg-gray-200 mt-2">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
                setTimeout(() => document.getElementById('taskInput')?.focus(), 100);
                
                const input = document.getElementById('taskInput');
                if (input) {
                    input.addEventListener('keypress', (e) => {
                        if (e.key === 'Enter') {
                            this.addTaskWithPriority('medium');
                        }
                    });
                }
            }

            showAddHabitModal() {
                const modal = document.createElement('div');
                modal.innerHTML = `
                    <div class="modal-backdrop" onclick="app.closeModal()"></div>
                    <div class="modal-content p-6">
                        <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-4"></div>
                        <h3 class="text-2xl font-bold gradient-text mb-4">‚ú® –ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞</h3>
                        <input 
                            type="text" 
                            id="habitInput"
                            placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏..."
                            class="w-full px-4 py-4 border-2 border-gray-200 rounded-2xl focus:outline-none focus:border-purple-500 mb-4 text-base"
                        />
                        <p class="text-sm text-gray-600 mb-3 font-semibold">–í—ã–±–µ—Ä–∏—Ç–µ –∏–∫–æ–Ω–∫—É:</p>
                        <div class="grid grid-cols-4 gap-3 mb-4">
                            ${['üí™', 'üìö', 'üßò', 'üíß', 'üèÉ', 'ü•ó', 'üò¥', 'üé®', 'üéØ', '‚úçÔ∏è', 'üéµ', 'üå±', 'üö¥', 'üß†', '‚ù§Ô∏è', '‚òÄÔ∏è'].map(icon => `
                                <button 
                                    onclick="app.addHabitWithIcon('${icon}')"
                                    class="text-4xl p-4 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl hover:shadow-lg active:scale-95 transition-all"
                                >
                                    ${icon}
                                </button>
                            `).join('')}
                        </div>
                        <button onclick="app.closeModal()" class="w-full py-4 bg-gray-100 text-gray-700 rounded-2xl font-semibold active:bg-gray-200">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                `;
                
                document.body.appendChild(modal);
                setTimeout(() => document.getElementById('habitInput')?.focus(), 100);
            }

            showUpgradeModal(message) {
                const modal = document.createElement('div');
                modal.innerHTML = `
                    <div class="modal-backdrop" onclick="app.closeModal()"></div>
                    <div class="modal-content p-6">
                        <div class="text-center">
                            <div class="w-20 h-20 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full flex items-center justify-center mx-auto mb-4 floating">
                                <span class="text-4xl">üíé</span>
                            </div>
                            <h3 class="text-2xl font-bold text-gray-800 mb-2">–û–±–Ω–æ–≤–∏—Ç–µ —Ç–∞—Ä–∏—Ñ</h3>
                            <p class="text-gray-600 mb-6">${message}</p>
                            <button onclick="app.setView('subscription'); app.closeModal();" class="w-full py-4 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-2xl font-bold shadow-lg mb-3">
                                ‚≠ê –°–º–æ—Ç—Ä–µ—Ç—å —Ç–∞—Ä–∏—Ñ—ã
                            </button>
                            <button onclick="app.closeModal()" class="w-full py-3 text-gray-600">
                                –ü–æ–∑–∂–µ
                            </button>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            addTaskWithPriority(priority) {
                const input = document.getElementById('taskInput');
                if (input && input.value.trim()) {
                    this.addTask(input.value, priority);
                    this.closeModal();
                }
            }

            addHabitWithIcon(icon) {
                const input = document.getElementById('habitInput');
                if (input && input.value.trim()) {
                    this.addHabit(input.value, icon);
                    this.closeModal();
                }
            }

            closeModal() {
                const modals = document.querySelectorAll('.modal-backdrop');
                modals.forEach(modal => modal.parentElement?.remove());
            }

            render() {
                const root = document.getElementById('root');
                root.innerHTML = `
                    <div class="min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-blue-50">
                        ${this.renderHeader()}
                        <div class="p-4 pb-24">
                            ${this.renderContent()}
                        </div>
                    </div>
                `;
            }

            renderHeader() {
                const filteredTasks = this.getFilteredTasks();
                return `
                    <div class="glass sticky top-0 z-40 p-4 pb-3 shadow-lg border-b border-purple-100">
                        <div class="flex items-center justify-between mb-3">
                            <div>
                                <h1 class="text-2xl font-bold gradient-text">NextStep</h1>
                                <p class="text-purple-600 text-xs font-medium">
                                    ${new Date().toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' })}
                                </p>
                            </div>
                            <div class="bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-full px-4 py-2 shadow-lg">
                                <span class="text-sm font-bold">
                                    ${filteredTasks.filter(t => !t.completed).length} –∑–∞–¥–∞—á
                                </span>
                            </div>
                        </div>
                        
                        <div class="flex gap-2 overflow-x-auto pb-2 scrollbar-hide -mx-4 px-4">
                            ${this.renderNavButtons()}
                        </div>
                    </div>
                `;
            }

            renderNavButtons() {
                const buttons = [
                    { id: 'inbox', icon: 'üì•', label: 'Inbox' },
                    { id: 'today', icon: 'üìÖ', label: 'Today' },
                    { id: 'focus', icon: 'üéØ', label: 'Focus' },
                    { id: 'review', icon: 'üìã', label: 'Review' },
                    { id: 'habits', icon: '‚ú®', label: '–ü—Ä–∏–≤—ã—á–∫–∏' },
                    { id: 'stats', icon: 'üìä', label: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞' },
                    { id: 'subscription', icon: 'üíé', label: '–ü–æ–¥–ø–∏—Å–∫–∞' },
                    { id: 'support', icon: '‚ùì', label: '–ü–æ–º–æ—â—å' }
                ];

                return buttons.map(btn => `
                    <button 
                        onclick="app.setView('${btn.id}')"
                        class="flex items-center gap-2 px-4 py-2.5 rounded-full transition-all whitespace-nowrap shadow-sm ${
                            this.view === btn.id 
                                ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white shadow-lg scale-105' 
                                : 'bg-white text-gray-700 hover:shadow-md active:scale-95'
                        }"
                    >
                        <span class="text-base">${btn.icon}</span>
                        <span class="text-sm font-semibold">${btn.label}</span>
                    </button>
                `).join('');
            }

            renderContent() {
                if (['inbox', 'today', 'focus', 'review'].includes(this.view)) {
                    return this.renderTasks();
                } else if (this.view === 'habits') {
                    return this.renderHabits();
                } else if (this.view === 'stats') {
                    return this.renderStats();
                } else if (this.view === 'subscription') {
                    return this.renderSubscription();
                } else if (this.view === 'support') {
                    return this.renderSupport();
                }
            }

            renderTasks() {
                const filteredTasks = this.getFilteredTasks();

                if (filteredTasks.length === 0) {
                    return `
                        <div class="text-center py-20">
                            <div class="w-28 h-28 bg-gradient-to-br from-purple-100 to-pink-100 rounded-full flex items-center justify-center mx-auto mb-6 floating">
                                <span class="text-6xl">‚ú®</span>
                            </div>
                            <p class="text-gray-600 text-xl font-semibold mb-2">–ó–∞–¥–∞—á –Ω–µ—Ç</p>
                            <p class="text-gray-400">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</p>
                        </div>
                    `;
                }

                return filteredTasks.map(task => `
                    <div class="task-card glass rounded-3xl p-5 shadow-md mb-4 border border-purple-100">
                        <div class="flex items-start gap-4">
                            <button 
                                onclick="app.toggleTask(${task.id})"
                                class="mt-1 flex-shrink-0 w-8 h-8 rounded-full border-3 flex items-center justify-center transition-all shadow-sm ${
                                    task.completed 
                                        ? 'bg-gradient-to-br from-green-400 to-green-600 border-green-600' 
                                        : 'border-gray-300 bg-white hover:border-purple-500 active:scale-90'
                                }"
                            >
                                ${task.completed ? '<span class="text-white text-lg font-bold">‚úì</span>' : ''}
                            </button>
                            <div class="flex-1 min-w-0">
                                <p class="font-semibold text-base ${task.completed ? 'line-through text-gray-400' : 'text-gray-800'}">
                                    ${task.text}
                                </p>
                                <div class="flex items-center gap-2 mt-3 flex-wrap">
                                    <span class="text-xs px-3 py-1.5 rounded-full font-semibold shadow-sm ${
                                        task.priority === 'high' ? 'bg-gradient-to-r from-red-400 to-red-500 text-white' :
                                        task.priority === 'medium' ? 'bg-gradient-to-r from-yellow-400 to-orange-400 text-white' :
                                        'bg-gradient-to-r from-green-400 to-green-500 text-white'
                                    }">
                                        ${task.priority === 'high' ? 'üî¥ –í–∞–∂–Ω–æ' : task.priority === 'medium' ? 'üü° –°—Ä–µ–¥–Ω–µ' : 'üü¢ –ù–∏–∑–∫–æ'}
                                    </span>
                                    ${!task.completed ? `
                                        <select 
                                            onchange="app.moveTask(${task.id}, this.value)"
                                            class="text-xs bg-purple-50 text-purple-700 px-3 py-1.5 rounded-full border-none font-semibold"
                                        >
                                            <option value="inbox" ${task.status === 'inbox' ? 'selected' : ''}>üì• Inbox</option>
                                            <option value="today" ${task.status === 'today' ? 'selected' : ''}>üìÖ Today</option>
                                            <option value="focus" ${task.status === 'focus' ? 'selected' : ''}>üéØ Focus</option>
                                        </select>
                                    ` : ''}
                                </div>
                            </div>
                            <button 
                                onclick="app.deleteTask(${task.id})"
                                class="text-red-400 hover:text-red-600 p-2 active:scale-90 transition-all"
                            >
                                <span class="text-2xl">√ó</span>
                            </button>
                        </div>
                    </div>
                `).join('');
            }

            renderHabits() {
                const today = new Date().toISOString().split('T')[0];
                
                return this.habits.map(habit => {
                    const isDoneToday = habit.lastDone === today;
                    return `
                        <div class="glass rounded-3xl p-5 shadow-md mb-4 border border-purple-100">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4 flex-1">
                                    <div class="w-14 h-14 bg-gradient-to-br from-purple-100 to-pink-100 rounded-2xl flex items-center justify-center">
                                        <span class="text-3xl">${habit.icon}</span>
                                    </div>
                                    <div class="flex-1">
                                        <p class="font-semibold text-gray-800 text-base">${habit.title}</p>
                                        <p class="text-sm text-gray-500 font-medium mt-1">
                                            <span class="text-orange-500 font-bold">${habit.streak}</span> 
                                            ${habit.streak === 1 ? '–¥–µ–Ω—å' : habit.streak < 5 ? '–¥–Ω—è' : '–¥–Ω–µ–π'} –ø–æ–¥—Ä—è–¥ üî•
                                        </p>
                                    </div>
                                </div>
                                <button 
                                    onclick="app.checkHabit(${habit.id})"
                                    ${isDoneToday ? 'disabled' : ''}
                                    class="w-14 h-14 rounded-2xl flex items-center justify-center transition-all shadow-lg ${
                                        isDoneToday 
                                            ? 'bg-gradient-to-br from-green-400 to-green-600 text-white' 
                                            : 'bg-white text-gray-300 active:scale-90 active:shadow-md hover:text-green-500'
                                    }"
                                >
                                    <span class="text-3xl">${isDoneToday ? '‚úì' : '‚óã'}</span>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
            }

            renderStats() {
                const completed = this.tasks.filter(t => t.completed).length;
                const maxStreak = this.habits.length > 0 ? Math.max(...this.habits.map(h => h.streak)) : 0;
                const today = new Date().toISOString().split('T')[0];
                const doneToday = this.habits.filter(h => h.lastDone === today).length;
                
                return `
                    <div class="grid grid-cols-2 gap-4 mb

<function_calls>
<invoke name="artifacts">
<parameter name="command">update</parameter>
<parameter name="id">github-pages-html</parameter>
<parameter name="old_str">                    <div class="grid grid-cols-2 gap-4 mb</parameter>
<parameter name="new_str">                    <div class="grid grid-cols-2 gap-4 mb-6">
<div class="glass rounded-3xl p-6 shadow-lg border border-blue-200">
<div class="w-12 h-12 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center mb-3">
<span class="text-2xl">üìã</span>
</div>
<p class="text-sm text-gray-600 font-medium mb-1">–í—Å–µ–≥–æ –∑–∞–¥–∞—á</p>
<p class="text-4xl font-bold gradient-text">${this.tasks.length}</p>
</div>
<div class="glass rounded-3xl p-6 shadow-lg border border-green-200">
<div class="w-12 h-12 bg-gradient-to-br from-green-400 to-green-600 rounded-2xl flex items-center justify-center mb-3">
<span class="text-2xl">‚úÖ</span>
</div>
<p class="text-sm text-gray-600 font-medium mb-1">–ó–∞–≤–µ—Ä—à–µ–Ω–æ</p>
<p class="text-4xl font-bold gradient-text">${completed}</p>
</div>
<div class="glass rounded-3xl p-6 shadow-lg border border-purple-200">
<div class="w-12 h-12 bg-gradient-to-br from-purple-400 to-purple-600 rounded-2xl flex items-center justify-center mb-3">
<span class="text-2xl">‚ú®</span>
</div>
<p class="text-sm text-gray-600 font-medium mb-1">–ü—Ä–∏–≤—ã—á–µ–∫</p>
<p class="text-4xl font-bold gradient-text">${this.habits.length}</p>
</div>
<div class="glass rounded-3xl p-6 shadow-lg border border-orange-200">
<div class="w-12 h-12 bg-gradient-to-br from-orange-400 to-red-600 rounded-2xl flex items-center justify-center mb-3">
<span class="text-2xl">üî•</span>
</div>
<p class="text-sm text-gray-600 font-medium mb-1">Max Streak</p>
<p class="text-4xl font-bold gradient-text">${maxStreak}</p>
</div>
</div>

<div class="glass rounded-3xl p-6 shadow-lg border border-purple-100 mb-6">
                    <h3 class="font-bold text-gray-800 mb-4 text-lg flex items-center gap-2">
                        <span class="text-2xl">üéØ</span>
                        –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–µ–≥–æ–¥–Ω—è
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600 font-medium">–ü—Ä–∏–≤—ã—á–∫–∏</span>
                                <span class="font-bold gradient-text">${doneToday}/${this.habits.length}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all" 
                                     style="width: ${this.habits.length > 0 ? (doneToday / this.habits.length * 100) : 0}%">
                                </div>
                            </div>
                        </div>
                        <div>
                            <div class="flex justify-between text-sm mb-2">
                                <span class="text-gray-600 font-medium">–ó–∞–¥–∞—á–∏</span>
                                <span class="font-bold gradient-text">${completed}/${this.tasks.length}</span>
                            </div>
                            <div class="w-full bg-gray-200 rounded-full h-3">
                                <div class="bg-gradient-to-r from-blue-500 to-cyan-500 h-3 rounded-full transition-all" 
                                     style="width: ${this.tasks.length > 0 ? (completed / this.tasks.length * 100) : 0}%">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="glass rounded-3xl p-6 shadow-lg border border-purple-100">
                    <h3 class="font-bold text-gray-800 mb-4 text-lg flex items-center gap-2">
                        <span class="text-2xl">üìà</span>
                        –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∑–∞ –Ω–µ–¥–µ–ª—é
                    </h3>
                    <div class="space-y-3">
                        ${['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'].map((day, i) => {
                            const percent = Math.min(100, Math.random() * 100);
                            return `
                                <div class="flex items-center gap-3">
                                    <span class="text-sm text-gray-600 font-medium w-10">${day}</span>
                                    <div class="flex-1 bg-gray-200 rounded-full h-3">
                                        <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-3 rounded-full transition-all" 
                                             style="width: ${percent}%">
                                        </div>
                                    </div>
                                    <span class="text-sm text-gray-600 font-bold w-12 text-right">
                                        ${Math.floor(percent)}%
                                    </span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        renderSubscription() {
            const plans = [
                {
                    name: 'FREE',
                    icon: 'üÜì',
                    price: 0,
                    period: '',
                    features: [
                        '–î–æ 50 –∑–∞–¥–∞—á',
                        '–ë–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏',
                        '–¢—Ä–µ–∫–µ—Ä –ø—Ä–∏–≤—ã—á–µ–∫',
                        '–ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞'
                    ],
                    gradient: 'from-gray-400 to-gray-600',
                    current: this.userPlan === 'free'
                },
                {
                    name: 'PREMIUM',
                    icon: '‚≠ê',
                    price: 149,
                    yearlyPrice: 1788,
                    monthlyPrice: 199,
                    period: '–≤ –º–µ—Å—è—Ü',
                    badge: '–ü–æ–ø—É–ª—è—Ä–Ω—ã–π',
                    features: [
                        '‚ú® –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏',
                        'üìä –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞',
                        'üé® –¢–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è',
                        '‚ö° –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞',
                        'üì± –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤'
                    ],
                    gradient: 'from-purple-500 to-pink-500',
                    current: this.userPlan === 'premium'
                },
                {
                    name: 'PRO',
                    icon: 'üèÜ',
                    price: 219,
                    yearlyPrice: 2628,
                    monthlyPrice: 249,
                    period: '–≤ –º–µ—Å—è—Ü',
                    badge: '–õ—É—á—à–µ–µ',
                    features: [
                        '‚≠ê –í—Å—ë –∏–∑ Premium',
                        'üë• –°–æ–≤–º–µ—Å—Ç–Ω–∞—è —Ä–∞–±–æ—Ç–∞',
                        'üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (Google Calendar)',
                        'üì§ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö',
                        'üîå API –¥–æ—Å—Ç—É–ø',
                        'üéØ AI-–ø–æ–º–æ—â–Ω–∏–∫'
                    ],
                    gradient: 'from-orange-500 to-red-600',
                    current: this.userPlan === 'pro'
                }
            ];

            return `
                <div class="space-y-4">
                    ${plans.map(plan => `
                        <div class="glass rounded-3xl p-6 shadow-lg border ${plan.current ? 'border-purple-500 border-2' : 'border-purple-100'}">
                            ${plan.badge ? `
                                <div class="inline-block bg-gradient-to-r ${plan.gradient} text-white text-xs font-bold px-3 py-1 rounded-full mb-3">
                                    ${plan.badge}
                                </div>
                            ` : ''}
                            ${plan.current ? '<div class="inline-block bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full mb-3 ml-2">–¢–µ–∫—É—â–∏–π</div>' : ''}
                            
                            <div class="flex items-center justify-between mb-4">
                                <div class="flex items-center gap-3">
                                    <span class="text-4xl">${plan.icon}</span>
                                    <div>
                                        <h3 class="text-2xl font-bold gradient-text">${plan.name}</h3>
                                        ${plan.price > 0 ? `
                                            <div class="text-sm text-gray-600">
                                                <span class="font-bold text-lg">${plan.price}‚ÇΩ</span> ${plan.period}
                                            </div>
                                        ` : '<p class="text-gray-600 text-sm">–ù–∞–≤—Å–µ–≥–¥–∞</p>'}
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-2 mb-6">
                                ${plan.features.map(f => `
                                    <div class="flex items-center gap-2 text-gray-700">
                                        <span class="text-green-500">‚úì</span>
                                        <span class="text-sm">${f}</span>
                                    </div>
                                `).join('')}
                            </div>

                            ${plan.price > 0 && !plan.current ? `
                                <div class="space-y-2">
                                    <button 
                                        onclick="tg.openTelegramLink('https://t.me/${tg.initDataUnsafe?.user?.username || 'bot'}?start=sub_${plan.name.toLowerCase()}_yearly')"
                                        class="w-full py-4 bg-gradient-to-r ${plan.gradient} text-white rounded-2xl font-bold shadow-lg active:shadow-md shine"
                                    >
                                        ${plan.yearlyPrice}‚ÇΩ/–≥–æ–¥ (-20%) ‚Ä¢ –û—Ñ–æ—Ä–º–∏—Ç—å
                                    </button>
                                    <button 
                                        onclick="tg.openTelegramLink('https://t.me/${tg.initDataUnsafe?.user?.username || 'bot'}?start=sub_${plan.name.toLowerCase()}_monthly')"
                                        class="w-full py-3 bg-white border-2 border-gray-300 text-gray-700 rounded-2xl font-semibold active:bg-gray-50"
                                    >
                                        ${plan.monthlyPrice}‚ÇΩ/–º–µ—Å ‚Ä¢ –ü–æ–º–µ—Å—è—á–Ω–æ
                                    </button>
                                </div>
                            ` : plan.current ? `
                                <div class="py-3 bg-green-50 text-green-700 rounded-2xl text-center font-semibold">
                                    ‚úÖ –ê–∫—Ç–∏–≤–Ω–∞
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}

                    <div class="glass rounded-2xl p-4 border border-blue-200 mt-6">
                        <p class="text-sm text-gray-600 text-center">
                            üí≥ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ Telegram Payments
                        </p>
                    </div>
                </div>
            `;
        }

        renderSupport() {
            return `
                <div class="space-y-4">
                    <div class="text-center py-8">
                        <div class="w-24 h-24 bg-gradient-to-br from-blue-400 to-purple-500 rounded-full flex items-center justify-center mx-auto mb-6 floating">
                            <span class="text-5xl">üí¨</span>
                        </div>
                        <h2 class="text-3xl font-bold gradient-text mb-2">–ü–æ–º–æ—â—å</h2>
                        <p class="text-gray-600">–ú—ã –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –ø–æ–º–æ—á—å!</p>
                    </div>

                    <div class="glass rounded-3xl p-6 shadow-lg border border-purple-100">
                        <h3 class="font-bold text-gray-800 mb-4 text-lg">üìö –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å</h3>
                        <div class="space-y-3 text-sm text-gray-700">
                            <div class="flex gap-3">
                                <span class="text-2xl">1Ô∏è‚É£</span>
                                <div>
                                    <p class="font-semibold mb-1">–î–æ–±–∞–≤–ª—è–π—Ç–µ –∑–∞–¥–∞—á–∏</p>
                                    <p class="text-gray-600">–í—Å–µ –Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ –ø–æ–ø–∞–¥–∞—é—Ç –≤ Inbox</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <span class="text-2xl">2Ô∏è‚É£</span>
                                <div>
                                    <p class="font-semibold mb-1">–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –¥–µ–Ω—å</p>
                                    <p class="text-gray-600">–ü–µ—Ä–µ–º–µ—â–∞–π—Ç–µ –∑–∞–¥–∞—á–∏ –≤ Today –∏ Focus</p>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <span class="text-2xl">3Ô∏è‚É£</span>
                                <div>
                                    <p class="font-semibold mb-1">–°–ª–µ–¥–∏—Ç–µ –∑–∞ –ø—Ä–∏–≤—ã—á–∫–∞–º–∏</p>
                                    <p class="text-gray-600">–û—Ç–º–µ—á–∞–π—Ç–µ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –¥–ª—è streak üî•</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <a href="https://t.me/NextStepSupport" class="block">
                        <div class="glass rounded-3xl p-6 shadow-lg border border-blue-200 active:scale-98 transition-all">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 bg-gradient-to-br from-blue-400 to-blue-600 rounded-2xl flex items-center justify-center">
                                    <span class="text-3xl">üí¨</span>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-bold text-gray-800">–ù–∞–ø–∏—Å–∞—Ç—å –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É</h4>
                                    <p class="text-sm text-gray-600">@NextStepSupport</p>
                                </div>
                                <span class="text-2xl text-gray-400">‚Üí</span>
                            </div>
                        </div>
                    </a>

                    <div class="glass rounded-3xl p-6 shadow-lg border border-purple-100">
                        <h3 class="font-bold text-gray-800 mb-3">‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h3>
                        <div class="space-y-3">
                            <details class="group">
                                <summary class="font-semibold text-gray-700 cursor-pointer hover:text-purple-600 transition-colors">
                                    –ö–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏?
                                </summary>
                                <p class="text-sm text-gray-600 mt-2 pl-4">
                                    –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ –≤–∞—à Telegram –∞–∫–∫–∞—É–Ω—Ç. –ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –Ω–∞ –ª—é–±–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ!
                                </p>
                            </details>
                            <details class="group">
                                <summary class="font-semibold text-gray-700 cursor-pointer hover:text-purple-600 transition-colors">
                                    –ß—Ç–æ —Ç–∞–∫–æ–µ streak –≤ –ø—Ä–∏–≤—ã—á–∫–∞—Ö?
                                </summary>
                                <p class="text-sm text-gray-600 mt-2 pl-4">
                                    Streak ‚Äî —ç—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥, –∫–æ–≥–¥–∞ –≤—ã –æ—Ç–º–µ—á–∞–ª–∏ –ø—Ä–∏–≤—ã—á–∫—É. –ß–µ–º –¥–ª–∏–Ω–Ω–µ–µ streak, —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ –ø—Ä–∏–≤—ã—á–∫–∞! üî•
                                </p>
                            </details>
                            <details class="group">
                                <summary class="font-semibold text-gray-700 cursor-pointer hover:text-purple-600 transition-colors">
                                    –ú–æ–∂–Ω–æ –ª–∏ –≤–µ—Ä–Ω—É—Ç—å –¥–µ–Ω—å–≥–∏?
                                </summary>
                                <p class="text-sm text-gray-600 mt-2 pl-4">
                                    –î–∞! –ï—Å–ª–∏ –≤–∞–º –Ω–µ –ø–æ–Ω—Ä–∞–≤–∏–ª—Å—è —Å–µ—Ä–≤–∏—Å –≤ —Ç–µ—á–µ–Ω–∏–µ 7 –¥–Ω–µ–π, –º—ã –≤–µ—Ä–Ω–µ–º –¥–µ–Ω—å–≥–∏. –ù–∞–ø–∏—à–∏—Ç–µ –≤ @NextStepSupport.
                                </p>
                            </details>
                        </div>
                    </div>

                    <div class="text-center text-sm text-gray-500 py-4">
                        <p>NextStep v2.0</p>
                        <p class="mt-1">Made with ‚ù§Ô∏è by NextStep Team</p>
                    </div>
                </div>
            `;
        }
    }

    const app = new NextStepApp();
    window.app = app;
</script>